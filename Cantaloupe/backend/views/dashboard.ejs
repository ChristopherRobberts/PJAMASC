
<!doctype html>
<html lang="{{ app()->getLocale() }}">
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link href="/stylesheets/reset.css" rel="stylesheet">
        <link href="/stylesheets/general.css" rel="stylesheet">
        <link href="/stylesheets/specific.css" rel="stylesheet">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://unpkg.com/vue"></script>

        <title>Cantaloupe</title>
        <!--<script>
            function validateForm() {
                var uname = document.forms["loginForm"]["uname"].value;
                var pword = document.forms["loginForm"]["pword"].value;
                if (uname == "") {
                    alert("Username must be filled out");
                    return false;
                }
                if (pword == "") {
                    alert("Username must be filled out");
                    return false;
                }
                if (uname == "incorrect") {
                    alert("Login failed - incorrect username or password");
                    return false;
                }
                if (pword == "incorrect") {
                    alert("Login failed - incorrect username or password");
                    return false;
                }

            }
      </script>-->

    </head>

    <body>

      <div class="wrapper">
        <div id=row1>
          <h1 id ="dash">Dashboard</h1>

          <img id=loginpic src = "/images/me.png" alt="img src error" height="50">

          <div id="username"></div>
          <form name="logoutForm" action="logout" method="post">
            <input type="submit" id="logoutbtn" value="Log out">
          </form>


        </div>
        <div id=maincol>

          <div id=list>
          <div id = "items">

            <table class="item-list">

              <tr>

                <th class="item-attribute left">
                  product
                </th>
                <th class="item-attribute">
                  owner
                </th>
                <th class="item-attribute">
                  description
                </th>
                <th class="item-attribute">
                  image
                </th>
                <th class="item-attribute right">
                  quantity
                </th>

              </tr>

              <tr v-for="item in items" class="item-container">

                <th class="item-cell product"> {{ item.username }} </th>
                <th class="item-cell owner"> {{ item.comment }} </th>
                <th class="item-cell description" onclick="javascript:showDiv('description');"> description </th>
                <th class="item-cell image"> image.png </th>
                <th class="item-cell quantity"> quantity </th>
                <th class="item-cell button">
                  <button v-if="item.deletable" @click="deleteitem(item.item_id)">Delete</button>
                  <button class="list-button" @click="deleteitem(item.item_id)">Delete</button>
                </th>

              </tr>
              <tr>

                <th class="item-cell input">
                  <input class="in" type="text" name="product" maxlength="200" v-model="product" required>
                </th>
                <th class="item-cell input">
                  <input class="in" type="text" name="owner" maxlength="200" v-model="owner" required></input>
                </th>
                <th class="item-cell input">
                  <input class="in" type="text" name="item" maxlength="200" v-model="itemText" required>
                </th>
                <th class="item-cell input">
                  image.png
                </th>
                <th class="item-cell input">
                  <input class="in" type="text" name="item" maxlength="200" v-model="itemText" required>
                </th>
                <th class="item-cell input">
                  <button class="" @click="submititem">Submit</button>
                </th>

              </tr>

            </table>
          </div>
        </div>
          <div id="expand">
            <h2>Display info</h2>
            <br>
            <span>
              data
            </span>
          </div>
        </div>
      </div>
      <script>
        function showDiv(data)
        {
          div = document.getElementById('expand');
          div.style.display = "block";
          div.innerHTML = data;
        }
      </script>

      <script>
          var app = new Vue({
              el: '#items',
              data:
                  {
                      displayInfo:'',
                      displayData:'',
                      items: [],
                      itemText: '',
                      product: '',
                      description: '',
                      image:'',
                      quantity: '',
                      sku: '',
                      showDiv:'',
                  },
              methods:
                  {
                      //--------METHODS-------
                      editdescription(sku,user,desc)
                      {
                          $.ajax({
                              method: 'POST',
                              url: '../public/api/editdescription.php',
                              data:
                                  {
                                      //SKU + user together identify item:
                                      item_sku: sku,
                                      item_user: user,
                                      //The new product name
                                      edit_product: desc
                                  }
                          }).done(function(data)
                          {
                              console.log('edited product')
                              this.getAllItems()
                          }.bind(this))
                      },
                      getAllItems()
                      {
                          $.ajax({
                              url: './item/getAllItems'
                          }).done(function(data)
                          {
                              this.items = JSON.parse(data);
                          }.bind(this))
                      },
                      postitem()
                      {
                          $.ajax({
                              method: 'POST',
                              url: '../public/api/postitem.php',
                              data:
                                  {
                                      product: this.product,
                                      description: this.description,
                                      quantity: this.quantity
                                  }
                          }).done(function(data)
                          {
                              console.log(this)
                              console.log('posted item:' + this.itemText)
                              this.itemText = "";
                              this.product = "",
                                  this.description = "",
                                  this.quantity = "",
                                  this.getAllItems()
                          }.bind(this))
                      },
                      //----------EVENTS-----------
                      editsku(item)
                      {
                          $.ajax({
                              method: 'POST',
                              url: '../public/api/editimage.php',//TODO js
                              data:
                                  {
                                      //SKU + user together identify item:
                                      item_sku: item.sku,
                                      item_user: item.user,
                                      //The new product name
                                      edit_image: this.image //TODO image format?
                                  }
                          }).done(function(data)
                          {
                              console.log('edited image')
                              this.getAllItems()
                          }.bind(this))
                      },
                      editquantity(item)
                      {
                          $.ajax({
                              method: 'POST',
                              url: '../public/api/editquantity.php', //TODO js
                              data:
                                  {
                                      //SKU + user together identify item:
                                      item_sku: item.sku,
                                      item_user: item.user,
                                      //The new product name
                                      edit_sku: this.sku
                                  }
                          }).done(function(data)
                          {
                              console.log('edited sku')
                              this.getAllItems()
                          }.bind(this))
                      },
                      editimage(item)
                      {
                          $.ajax({
                              method: 'POST',
                              url: '../public/api/editimage.php',//TODO js
                              data:
                                  {
                                      //SKU + user together identify item:
                                      item_sku: item.sku,
                                      item_user: item.user,
                                      //The new product name
                                      edit_image: this.image //TODO image format?
                                  }
                          }).done(function(data)
                          {
                              console.log('edited image')
                              this.getAllItems()
                          }.bind(this))
                      },
                      editquantity(item)
                      {
                          $.ajax({
                              method: 'POST',
                              url: '../public/api/editquantity.php', //TODO js
                              data:
                                  {
                                      //SKU + user together identify item:
                                      item_sku: item.sku,
                                      item_user: item.user,
                                      //The new product name
                                      edit_product: this.quantity
                                  }
                          }).done(function(data)
                          {
                              console.log('edited quantity')
                              this.getAllItems()
                          }.bind(this))
                      },
                      showdiv(product, data)
                      {
                          showDiv = document.getElementById('expand');
                          showDiv.style.display = "block";
                          this.displayInfo = product;
                          this.displayData = data;
                          console.log(this.displayInfo);
                          //document.getElementById('info').innerHTML = product;
                          //document.getElementById('data').innerHTML = data;
                      },
                      editproduct(item)
                      {
                          $.ajax({
                              method: 'POST',
                              url: '../public/api/editproduct.php',
                              data:
                                  {
                                      //SKU + user together identify item:
                                      item_sku: item.sku,
                                      item_user: item.user,
                                      //The new product name
                                      edit_product: this.product
                                  }
                          }).done(function(data)
                          {
                              console.log('edited product')
                              this.getAllItems()
                          }.bind(this))
                      },
                      submititem(event)
                      {
                          this.postitem()
                      },
                      deleteitem(item)
                      {
                          $.ajax({
                              method: 'POST',
                              url: '../public/api/deleteitem.php',
                              data:
                                  {
                                      item_sku: item.sku,
                                      item_user: item.user
                                  }
                          }).done(function(data)
                          {
                              console.log("deleted item " + item.product)
                              this.getAllItems()
                          }.bind(this))
                      },
                  },
              mounted()
              {
                  this.getAllItems()
              }
          })
      </script>
    </body>
</html>
