<!doctype html>
<html lang="{{ app()->getLocale() }}">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="/stylesheets/reset.css" rel="stylesheet">
    <link href="/stylesheets/general.css" rel="stylesheet">
    <link href="/stylesheets/specific.css" rel="stylesheet">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://unpkg.com/vue"></script>

    <title>Cantaloupe</title>

</head>
<body>

<div class="wrapper">
    <div id=row1>
        <h1 id="dash">Dashboard</h1>
        <img id=loginpic src="/images/me.png" alt="img src error" height="50">
        <div id="username"></div>

        <form name="logoutform" action="logout" method="post">
            <input type="submit" id="logoutbtn" value="Log out"/>
        </form>
    </div>

    <div id=maincol>
        <div id=list>
            <div id="items">
                <table class="item-list">
                    <tr>
                        <th class="item-attribute left"> product</th>
                        <th class="item-attribute"> description</th>
                        <th class="item-attribute"> image</th>
                        <th class="item-attribute"> quantity</th>
                        <th class="item-attribute right"> sku</th>
                    </tr>

                    <tr v-for="item in items" class="item-container">

                        <th class="item-cell"> {{ item.name }}
                            <button class="insertbtn" @click="editproduct(item)">insert</button>
                        </th>
                        <th class="item-cell hoverable" @click="showdiv(item.name, item.description);">
                            {{item.description}}
                            <button class="insertbtn" @click="editdescription(item)">insert</button>
                        </th>
                        <th class="item-cell hoverable" @click="showdiv(item.name, item.image);">
                            {{item.image}}
                            <button class="insertbtn" @click="editimage(item)">insert</button>
                        </th>
                        <th class="item-cell">
                            {{item.quantity}}
                            <button class="insertbtn" @click="editquantity(item)">insert</button>
                        </th>
                        <th class="item-cell">
                            {{item.sku}}
                            <button class="insertbtn" @click="editsku(item)">insert</button>
                        </th>
                        <th class="item-cell">
                            <button class="list-button" @click="deleteitem(item)">Delete</button>
                        </th>

                    </tr>
                    <tr>

                        <th class="item-cell input">
                            <input class="in" type="text" name="product" maxlength="200" v-model="product">
                        </th>
                        <th class="item-cell input">
                            <input class="in" type="text" name="description" maxlength="200" v-model="description">
                        </th>
                        <th class="item-cell input">
                            <input type="file" id="imagein" v-on="image" accept="image/png, image/jpeg"/>
                        </th>
                        <th class="item-cell input">
                            <input class="in" type="text" name="quantity" maxlength="200" v-model="quantity">
                        </th>
                        <th class="item-cell input">
                            <input class="in" type="text" name="sku" maxlength="200" v-model="sku">
                        </th>
                        <th class="item-cell input">
                            <button class="" @click="submititem">Submit</button>
                        </th>

                    </tr>

                </table>
                <div id="expand">
                    <h2 id="info" v-html="displayInfo">{{displayInfo}}</h2>
                    <br>
                    <span v-html="displayData"> {{displayData}} data </span>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var app = new Vue({
        el: '#items',
        data:
            {
                displayInfo: '',
                displayData: '',
                items: [],
                itemText: '',
                product: '',
                description: '',
                image: '',
                quantity: '',
                sku: '',
                showDiv: '',
            },
        methods:
            {
                //--------METHODS-------
                editdescription(item) {
                    $.ajax({
                        method: 'POST',
                        url: '/item/edit-description',
                        data:
                            {
                                //SKU + user together identify item:
                                sku: item.sku,
                                //The new product name
                                description: this.description
                            }
                    }).done(function (data) {
                        console.log('edited product');
                        this.getAllItems();
                    }.bind(this))
                },
                getAllItems() {
                    $.ajax({
                        url: './item/getAllItems'
                    }).done(function (data) {
                        this.items = data;

                    }.bind(this))
                },
                addItem() {
                    $.ajax({
                        method: 'POST',
                        url: './item/addItem',
                        data:
                            {
                                sku: this.sku,
                                name: this.product,
                                description: this.description,
                                amount: this.quantity,
                                image: this.image
                            }
                    }).done(function (data) {
                        console.log(this)
                        console.log('posted item:' + this.product)
                        console.log('containing image:' + this.image)
                        this.product = "";
                        this.description = "";
                        this.quantity = "";
                        this.sku = "";
                        this.getAllItems()
                    }.bind(this))
                },
                //----------EVENTS-----------
                editsku(item) {
                    $.ajax({
                        method: 'POST',
                        url: '../public/api/editimage.php',//TODO js
                        data:
                            {
                                //SKU + user together identify item:
                                item_sku: item.sku,
                                item_user: item.user,
                                //The new product name
                                edit_image: this.image //TODO image format?
                            }
                    }).done(function (data) {
                        console.log('edited image')
                        this.getAllItems()
                    }.bind(this))
                },
                editquantity(item) {
                    $.ajax({
                        method: 'POST',
                        url: '../public/api/editquantity.php', //TODO js
                        data:
                            {
                                //SKU + user together identify item:
                                item_sku: item.sku,
                                item_user: item.user,
                                //The new product name
                                edit_sku: this.sku
                            }
                    }).done(function (data) {
                        console.log('edited sku')
                        this.getAllItems()
                    }.bind(this))
                },
                editimage(item) {
                    $.ajax({
                        method: 'POST',
                        url: '../public/api/editimage.php',//TODO js
                        data:
                            {
                                //SKU + user together identify item:
                                item_sku: item.sku,
                                item_user: item.user,
                                //The new product name
                                edit_image: this.image //TODO image format?
                            }
                    }).done(function (data) {
                        console.log('edited image')
                        this.getAllItems()
                    }.bind(this))
                },
                showdiv(product, data) {
                    showDiv = document.getElementById('expand');
                    showDiv.style.display = "block";
                    this.displayInfo = product;
                    this.displayData = data;
                    console.log("Displayinfo: " + this.displayInfo);
                    //document.getElementById('info').innerHTML = product;
                    //document.getElementById('data').innerHTML = data;
                },
                editproduct(item) {
                    $.ajax({
                        method: 'POST',
                        url: '/item/edit-name',
                        data:
                            {
                                //SKU + user together identify item:
                                sku: item.sku,
                                //The new product name
                                product: this.product
                            }
                    }).done(function (data) {
                        console.log('edited product')
                        this.getAllItems()
                    }.bind(this))
                },
                submititem(event) {
                    this.addItem()
                },
                deleteitem(item) {
                    $.ajax({
                        method: 'POST',
                        url: './item/deleteItem',
                        data:
                            {
                                sku: item.sku
                            }
                    }).done(function (data) {
                        console.log(data.sku);
                        console.log("deleted item " + item.name)
                        this.getAllItems()
                    }.bind(this))
                },
            },
        mounted() {
            this.getAllItems()
        }
    })
</script>
</body>
</html>
